unit Principal;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs,
  FMX.Controls.Presentation, FMX.StdCtrls, FMX.Layouts, FMX.Objects,
  FMX.ListView.Types, FMX.ListView.Appearances, FMX.ListView.Adapters.Base,
  MultiDetailAppearanceU, FMX.ListView, System.ImageList, FMX.ImgList,ControlActividades;

type
  TForm2 = class(TForm)
    ScaledLayout1: TScaledLayout;
    Contenedor: TRectangle;
    ListadoUsuarios: TListView;
    ToolBar1: TToolBar;
    SpeedButton2: TSpeedButton;
    ImageList1: TImageList;
    SpeedButton3: TSpeedButton;
    SpeedButton5: TSpeedButton;
    procedure SpeedButton2Click(Sender: TObject);
    procedure SpeedButton5Click(Sender: TObject);
    procedure SpeedButton3Click(Sender: TObject);
  private
    { Private declarations }
  public

    { Public declarations }
  end;

var
  Form2: TForm2;
  Agente,Nombre:String;

implementation
Uses Datas;
{$R *.fmx}



procedure TForm2.SpeedButton2Click(Sender: TObject);
begin
    if ListadoUsuarios.Selected <> Nil then
    begin
        form2.Visible:=False;
        ControlActividades.Form3.NombreAgente.Text:=ListadoUsuarios.Items[ListadoUsuarios.ItemIndex].Text;
        ControlActividades.Form3.Visible:=True;
    end;
end;

procedure TForm2.SpeedButton3Click(Sender: TObject);
begin
  Application.Terminate;
  Exit;
end;

procedure TForm2.SpeedButton5Click(Sender: TObject);
var
  Items : TListViewItem;
begin
  //Este procedimiento realiza la carga de los usuarios que tienen acceso a esta aplicacion
  Datas.DataModule1.Consulta.SQL.Clear;
  Datas.DataModule1.Consulta.SQL.Add('SELECT agente,Nombre FROM agente WHERE estatus=:Estatus AND Tipo=:Tipo');
  Datas.DataModule1.Consulta.ParamByName('Estatus').AsString:='ALTA';
  Datas.DataModule1.Consulta.ParamByName('Tipo').AsString:='Mecanico';
  try
    Datas.DataModule1.Consulta.ExecSQL;

    if Datas.DataModule1.Consulta.RecordCount > 0 then
    begin
    with Datas.DataModule1.Consulta do
    begin
      while not Datas.DataModule1.Consulta.Eof do
      begin
          items := ListadoUsuarios.Items.Add;
          items.text:=Datas.DataModule1.Consulta.FieldByName('agente').AsString;
          items.Text:=Datas.DataModule1.Consulta.FieldByName('Nombre').AsString;
          Items.Data[TMultiDetailAppearanceNames.Detail1]:=Datas.DataModule1.Consulta.FieldByName('agente').AsString;
          Next;
      end;
    end;
  end;
  finally
      Datas.DataModule1.Consulta.Close;
  end;
end;

end.
